<?xml version='1.0' encoding='UTF-8'?>

<project>
    <target name="dita2ia-webhelp-responsive-ab"
            depends="dita2custom-webhelp-resp.init,
               build-init,
               dita2custom-webhelp-resp.copy,
               dita2check-condition-contain,
               dita2use-template,
               dita2transform-input-file,
               dita2go.to.top.btn,
               dita2webhelp-responsive"/>

    <target name="dita2custom-webhelp-resp.init">
        <property name="args.css.file" value="css/custom.css"/>
    </target>

    <target name="dita2custom-webhelp-resp.copy">
        <copy todir="${output.dir}/css">
            <fileset dir="${dita.plugin.com.ia-trainee-task-ab.dir}/css"/>
        </copy>
    </target>

    <target name="dita2check-condition-contain">
        <condition property="contains" value="user">
            <contains string="${args.input}" substring="user1" />
        </condition>
        <condition property="contains" value="IdeaProjects">
            <contains string="${args.input}" substring="IdeaProjects" />
        </condition>
        <property name="contains" value="default"/>
        <echo message="${contains}"/>
    </target>

    <condition property="check-transtype">
        <equals arg1="${transtype}" arg2="ia-webhelp-responsive-ab" trim="true"/>
    </condition>

    <target name="dita2use-template" if="check-transtype">
        <property name="webhelp.publishing.template"
                  value="${dita.plugin.com.ia-trainee-task-ab.dir}/templates/custom-template/custom-template-tree.opt"/>
        <property name="webhelp.template.index.terms.file"
                  value="${dita.plugin.com.ia-trainee-task-ab.dir}/page-templates/my-wt_terms.html"/>
        <property name="webhelp.fragment.footer"
                  value="${dita.plugin.com.ia-trainee-task-ab.dir}/my-footer.xml"/>
    </target>

    <target name="dita2transform-input-file">
        <script language="javascript"><![CDATA[
            var File = java.io.File;
            var FileReader = java.io.FileReader;
            var BufferedReader = java.io.BufferedReader;
            var FileWriter = java.io.FileWriter;
            var inputFile = project.getProperty("args.input");
            var inputDir = inputFile.substr(0, inputFile.lastIndexOf('/'));
            project.setUserProperty("args.input.dir", inputDir);
            ]]>
        </script>
        <xslt in="${args.input}"
              out="${args.input.dir}/reverse-book.ditamap"
              style="${dita.plugin.com.ia-trainee-task-ab.dir}/xsl/modify-ditamap.xsl">
            <xmlcatalog refid="dita.catalog"/>
        </xslt>
        <script language="javascript"><![CDATA[
            var File = java.io.File;
            var FileReader = java.io.FileReader;
            var BufferedReader = java.io.BufferedReader;
            var FileWriter = java.io.FileWriter;
            var inputDir = project.getProperty("args.input.dir");
            var newInputFile = inputDir.concat('/reverse-book.ditamap')
            project.setUserProperty("args.input", newInputFile);
            ]]>
        </script>
    </target>

    <target name="dita2go.to.top.btn">
        <copy todir="${output.dir}/js">
            <fileset dir="${dita.plugin.com.ia-trainee-task-ab.dir}/js"/>
        </copy>
        <property name="webhelp.fragment.after.body"
                  value="${dita.plugin.com.ia-trainee-task-ab.dir}/go2top-btn.xml"/>
    </target>
</project>